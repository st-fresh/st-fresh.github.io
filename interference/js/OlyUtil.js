var MEUtil=MEUtil||{};MEUtil.vendorPrefix={};MEUtil.IS_TOUCH_DEVICE=(function(a){if(a.match(/Android/i)||a.match(/webOS/i)||a.match(/iPhone/i)||a.match(/iPad/i)||a.match(/iPod/i)||a.match(/BlackBerry/)||a.match(/Windows Phone/i)||a.match(/ZuneWP7/i)){return true}else{return false}})(navigator.userAgent);MEUtil.PIXEL_RATIO=(function(){var a=document.createElement("canvas").getContext("2d"),b=window.devicePixelRatio||1,c=a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;return Math.max(b/c,1)})();MEUtil.PREFIXES=["webkit","moz","o","ms"];MEUtil.addClass=function(b,a){b.className+=" "+a};MEUtil.removeClass=function(b,a){b.className=b.className.replace(new RegExp("(?:^|s)"+a+"(?!S)","g"),"")};MEUtil.hasClass=function(b,a){return b.className.match(new RegExp("(?:^|s)"+a+"(?!S)"))};MEUtil.appendChildren=function(d,c){if(d.substring){d=document.getElementById(d)}for(var b=0,a=c.length;b<a;b++){d.appendChild(c[b])}};MEUtil.createCanvas=function(a,c,b){if(!b){b=MEUtil.PIXEL_RATIO}var d=document.createElement("canvas");d.width=a*b;d.height=c*b;d.style.width=a+"px";d.style.height=c+"px";if(b!==1){d.getContext("2d").setTransform(b,0,0,b,0,0)}return d};MEUtil.formatWithComma=function(a){return a.toString().replace(/(\d)(?=(\d{3})+$)/,"$1,")};MEUtil.getGlobalX=function(b){var a=0;do{a+=b.offsetLeft}while(b=b.offsetParent);return a};MEUtil.getGlobalY=function(a){var b=0;do{b+=a.offsetTop}while(a=a.offsetParent);return b};MEUtil.getGlobalPoint=function(b){var a=$(this._container).offset();return{x:a.left,y:a.top}};MEUtil.makeSuper=function(c,d){function b(){}b.prototype=d.prototype;var a=new b();a.constructor=c;c.prototype=a};MEUtil.on=function(d,c,f){var e=c.split(" ");for(var b=0,a=e.length;b<a;b++){d.addEventListener(e[b],f,false)}};MEUtil.off=function(d,c,f){var e=c.split(" ");for(var b=0,a=e.length;b<a;b++){d.removeEventListener(e[b],f,false)}};MEUtil.upscaleCanvas=function(e,d){if(e.substring){e=document.getElementById(e)}if(!d){d=MEUtil.PIXEL_RATIO}var b=e.clientWidth||e.width,c=e.clientHeight||e.height,a=e.getContext("2d");a.setTransform(1,0,0,1,0,0);e.width=b*d;e.height=c*d;e.style.width=b+"px";e.style.height=c+"px";a.setTransform(d,0,0,d,0,0);return e};MEUtil.loadFromDataSrc=function(c,j){var e=c.length;for(var d=0,b=e;d<b;d++){var h=c[d];if(typeof h!="string"){f(h)}else{g(h)}}function f(k){var l=k.getAttribute("data-src");k.removeAttribute("data-src");var i=new Image();i.onload=a(k);i.src=l}function g(k){var i=new Image();i.onload=a();i.src=k}function a(i){return function(){e--;if(i){switch(i.tagName.toLowerCase()){case"img":i.src=this.src;break;case"div":i.style.backgroundImage="url("+this.src+")";break;case"object":i.data=this.src;break;case"canvas":var k=i.getContext("2d");k.drawImage(this,0,0)}}if(j){if(j.onProgress){j.onProgress({type:"progress",response:i,progress:1-e/b})}if(!e&&j.onComplete){j.onComplete({type:"complete",response:c})}}}}};MEUtil.ImageStackr=function(d){var B=0,n=0,p=null,t=null,i=0,c=0,y=[],g=0,a=0,L=0,e=false,r=document.getElementById(d),H=d,E=null,F=null,b=null,s=0,h=function(){return B},D=function(){return p},m=function(){return t},f=function(){return c},x=function(){return r},J=function(){return c},K=function(){return H},o=function(){return((c-1)/(g-1))},I=function(P){P=(P+0.5)>>0;if(P!=c){if(P>=1&&P<=g){var M=p.width,N=p.height,O=y[P-1];c=P;t.clearRect(0,0,M,N);t.drawImage(E[O.spriteIndex],O.x,O.y,L,a,0,0,M,N);F.style.opacity=0}}},z=function(U,V,O,ab,N){var T=0,Q,X;if(O===undefined){O=$(r).width();ab=$(r).height()}if(N===undefined){N=1}y=[];g=0;E=null;try{var aa=U[0].width;Q=true;try{var Y=V[0];for(T=0;T<V.length;T++){g+=V[T]}X=true}catch(W){g=V;X=false}}catch(W){g=V;Q=false}if(p!==null){$(p).remove();$(F).remove()}p=document.createElement("canvas");F=document.createElement("canvas");E=k(U,Q);L=p.width=F.width=O;a=p.height=F.height=ab;p.style.width=F.style.width=r.clientWidth?r.clientWidth+"px":L+"px";p.style.height=F.style.height=r.clientHeight?r.clientHeight+"px":a+"px";t=p.getContext("2d");b=F.getContext("2d");var P={},S=[];if(Q){var M=0,Z=0;for(T=0;T<U.length;T++){M=(X)?V[T]:V;Z=(U[T].width/O)>>0;for(var R=0;R<M;R++){P={};P.spriteIndex=T;P.x=(R%Z)*L;P.y=((R/Z)>>0)*a;S.push(P)}}}else{Z=(U.width/L)>>0;for(T=0;T<V;T++){P={};P.spriteIndex=0;P.x=(T%Z)*L;P.y=((T/Z)>>0)*a;S.push(P)}}if(N===1){y=S}else{for(T=N-1;T<S.length;T++){y.push(S[T])}for(T=0;T<N-1;T++){y.push(S[T])}}$(F).css({position:"absolute",left:0,top:0});$("#"+H).append(p,F);I(1)},j=function(){if(B!==0){var O=new Date().getTime(),N=O-n,P=((N/B)+0.5)>>0,M=c+(P<6?P:5);if(B<=N+2){n=O;c=M<=g?M:M-g;I(c)}}else{A()}},A=function(){I(c<g?c+1:1)},q=function(){if(B!=0){var O=new Date().getTime(),N=O-n,P=((N/B)+0.5)>>0,M=c+(P<6?P:5);if(B<=N+2){n=O;c=M>0?M:M+g;I(c)}}else{l()}},l=function(){I(c>1?c-1:g)},u=function(S){var N=(S*(g-1))>>0,T=(N===(g-1))?N:N+1,R=y[N],Q=y[T],M=p.width,P=p.height,O=(S*(g-1))-N;if(c!==N+1||e===false){e=true;c=N+1;t.drawImage(E[R.spriteIndex],R.x,R.y,L,a,0,0,M,P);b.drawImage(E[Q.spriteIndex],Q.x,Q.y,L,a,0,0,M,P)}F.style.opacity=O},C=function(M){B=M;n=new Date().getTime()},G=function(M){I(M)},v=function(M){u(M)},w=function(N,M){p.style.width=F.style.width=N+"px";p.style.height=F.style.height=M+"px";I(c)},k=function(N,S){var R=[];if(S){for(var P=0;P<N.length;P++){var T=document.createElement("canvas"),O=T.getContext("2d"),M=N[P].width,Q=N[P].height;T.width=M;T.height=Q;O.drawImage(N[P],0,0);R.push(T)}}else{var T=document.createElement("canvas"),O=T.getContext("2d"),M=N.width,Q=N.height;T.width=M;T.height=Q;O.drawImage(N,0,0);R.push(T)}return R};return{getAnimationSpeed:h,getCanvas:D,getContext:m,getCurrentFrame:f,getElement:x,getFrame:J,getId:K,getProgress:o,gotoFrame:I,loadSpriteSheet:z,nextAnimationFrame:j,nextFrame:A,previousFrame:l,previousAnimationFrame:q,progress:u,setAnimationSpeed:C,setFrame:G,setProgress:v,setSize:w}};MEUtil.raf=(function(){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(b){window.setTimeout(b,1000/60)};return function(b){a(b)}})();MEUtil.setPrefixedEvent=function(c,f,e){var d=MEUtil.PREFIXES;for(var b=0,a=d.length;b<a;b++){c.addEventListener(d[b]+f,e,false)}c.addEventListener(f.toLowerCase(),e,false)};MEUtil.removePrefixedEvent=function(c,f,e){var d=MEUtil.PREFIXES;for(var b=0,a=d.length;b<a;b++){c.removeEventListener(d[b]+f,e,false)}c.removeEventListener(f.toLowerCase(),e,false)};MEUtil.getPrefixedProp=function(a){if(!MEUtil.vendorPrefix[a]){var f=MEUtil.PREFIXES,b=document.createElement("div"),e=a.charAt(0).toLowerCase()+a.slice(1),h=a.charAt(0).toUpperCase()+a.slice(1),j="",d=false;for(var g=0,c=f.length;g<c;g++){j=f[g]+h;if(j in b.style){MEUtil.vendorPrefix[a]=j;d=true;break}}if(!d&&e in b.style){MEUtil.vendorPrefix[a]=e}else{return e}}return MEUtil.vendorPrefix[a]};MEUtil.setRuleProperty=function(a,h,g){var e=document.styleSheets,f=null,d=0,b=0;for(var c=e.length-1;c>-1;c--){f=e[c].cssRules;b=f.length;for(d=0;d<b;d++){if(f[d].selectorText===a){f[d].style.setProperty(h,g,null);c=-1;break}}}};function OlyEvent(a,b){return{target:b,timeStamp:Date.now(),type:a}}function OlySplash(p,h){if(!(this instanceof OlySplash)){return new OlySplash(p,h)}(function(){if(document.getElementById("tutorialTitle")){var x=22;var v=document.getElementById("tutorialTitle");var t=v.innerHTML;var s=t.match(/<br>/g)?t.match(/<br>/g).length+1:1;var w=t.split("<br>");v.style.width="100%";v.style.height=x*s+"px";v.style.margin="15px auto";v.style.display="block";var r=MEUtil.upscaleCanvas("tutorialTitle").getContext("2d");var y=r.createLinearGradient(0,0,0,v.height);for(var u=0;u<s;u++){y.addColorStop(u/MEUtil.PIXEL_RATIO/s,"#ffffff");y.addColorStop((0.5+u)/MEUtil.PIXEL_RATIO/s,"#fdeb7a");y.addColorStop((1+u)/MEUtil.PIXEL_RATIO/s,"#faad18")}r.font="bold "+x+"px Arial";r.fillStyle=y;r.textBaseline="middle";r.textAlign="center";for(var u=0;u<w.length;u++){r.fillText(w[u].trim(),v.width/(2*MEUtil.PIXEL_RATIO),v.height/(2*MEUtil.PIXEL_RATIO)+x*u-x/2*(w.length-1)-2)}}})();var a=document.getElementById("splashContainer"),n=document.createElement("div"),e={border:document.createElement("div"),bar:document.createElement("div"),text:document.createElement("div"),progress:0},k=document.querySelector(".mainscene").clientWidth,f=100,g={can:MEUtil.createCanvas(k,f),img:new Image(),imgW:300,imgH:63,segs:new Array(9)},b=0;q();return{fadeOut:o};function q(){n.className="splashAnimationContainer";e.border.className="splashLoadingBarBorder";e.bar.className="splashLoadingBar";e.text.className="splashLoadingText";g.img.className="splashLogoImage";g.img.style.left=((k-g.imgW)*0.5)+"px";e.text.innerHTML="Loaded: 0%";e.border.appendChild(e.bar);MEUtil.appendChildren(n,[g.can,g.img,e.border,e.text]);a.appendChild(n);g.img.onload=i;g.img.src="images/tutorial-logo.png"}function i(){var s=g.can.getContext("2d");s.fillStyle="#003366";for(var t=0,r=g.segs.length;t<r;t++){g.segs[t]={progress:0};TweenLite.to(g.segs[t],0.25,{progress:1,delay:0.016+t*0.05,ease:Cubic.easeOut})}setTimeout(d,400);MEUtil.raf(j)}function j(){var t=g.can.getContext("2d"),s=g.segs,u=s.length,x=0,y=0,r=Math.round(k/u);if(s[u-1].progress<1){MEUtil.raf(j)}t.beginPath();for(var v=0;v<u;v++){x=s[v].progress*f;y=v<u-1?r:k-(r*(u-1));t.rect(r*v,f-x,y,x)}t.fill()}function d(){var r=(function(){var s=0,t=g.imgH/2;return{setVisible:function(u){var v=Math.round(u*t);s=u;g.img.style.opacity=u;g.img.style.clip="rect("+(t-v)+"px, "+g.imgW+"px, "+(t+v)+"px, 0)"},getVisible:function(){return s}}})();TweenLite.to(r,0.5,{setVisible:1,ease:Cubic.easeInOut,onComplete:c})}function c(){TweenLite.to([e.border,e.bar,e.text],0.25,{css:{opacity:1},onComplete:l})}function l(){var r=[];(function(){var t=document.querySelectorAll("[data-src]");for(var u=0,s=t.length;u<s;u++){r.push(t[u])}if(h){s=h.length;for(u=0;u<s;u++){r.push(h[u])}}})();MEUtil.raf(m);if(r.length){MEUtil.loadFromDataSrc(r,{onProgress:function(s){e.progress=s.progress}})}else{e.progress=1}}function m(){var r=Math.round(e.progress*100)+"%";e.bar.style.width=r;e.text.innerHTML="Loaded: "+r;if(e.progress<1){MEUtil.raf(m)}else{MEUtil.raf(function(){if(p){p()}})}}function o(){TweenLite.to(a,0.5,{css:{autoAlpha:0},delay:0.5})}}function OlyComponent(a){if(a){this._container=typeof a==="string"?document.getElementById(a):a;this._isEnabled=true;if(MEUtil.IS_TOUCH_DEVICE){this._container.addEventListener("touchstart",function(b){b.preventDefault()},false)}}else{console.error(a+" is not a valid id string or HTMLElement.")}}OlyComponent.prototype.addEventListener=function(b,c){b="on"+b;var a=this[b];if(a){if(typeof a==="function"){this[b]=[a,c]}else{this[b].push(c)}}else{this[b]=[c]}};OlyComponent.prototype.getElement=function(){return this._container};OlyComponent.prototype.getEnabled=function(){return this._isEnabled};OlyComponent.prototype.setEnabled=function(a){if(a!=this._isEnabled){if(a){this._enable()}else{this._disable()}}};OlyComponent.prototype._enable=function(){var b=this._container.style;var a=(function(d){function c(f){var e=f.currentTarget.style;MEUtil.removePrefixedEvent(this._container,"TransitionEnd",a);e.cursor="pointer";this._isEnabled=true}return c.bind(d)})(this);MEUtil.setPrefixedEvent(this._container,"TransitionEnd",a);b.opacity="1"};OlyComponent.prototype._disable=function(){var a=this._container.style;this._isEnabled=false;a.cursor="default";a.opacity=0.5};OlyComponent.prototype._dispatchEvent=function(d){var b=this["on"+d];if(typeof b==="function"){b.call(this,new OlyEvent(d,this))}else{if(b){for(var c=0,a=b.length;c<a;c++){b[c].call(this,new OlyEvent(d,this))}}}};function OlySlider(c,a){if(!(this instanceof arguments.callee)){return new arguments.callee(c,a)}OlyComponent.call(this,c);var b=this;a=a||{};this.hasChanged=false;this.onchange=null;this.ontouchstart=null;this.ontouchend=null;this.tickCount=a.tickCount!=undefined?a.tickCount:0;this._config={CSS:{container:"slider",handle:{border:{node:"sliderHandleBorder"},fill:{node:"sliderHandleFill",down:"sliderHandleFillDown",hover:"sliderHandleFillHover",up:"sliderHandleFillUp"}},track:{node:"sliderTrack",thresh:"sliderTrackThresh"},vertical:"verticalSlider"}};this._bounds={left:0,height:0,width:0};this._eventFlags={start:false,move:false,end:false};this._eventListener=MEUtil.IS_TOUCH_DEVICE?this._touchHandler.bind(this):this._mouseHandler.bind(this);this._handle={border:document.createElement("div"),fill:document.createElement("div"),height:0,innerHeight:0,innerWidth:0,spectrumCan:null,position:0,width:0,x:0};this._isActive=false;this._isSpectrum=a.isSpectrumSlider;this._orient=(function(){if(!a.orientation||a.orientation.toLowerCase()=="horizontal"){return"width"}return"height"})();this._spectrum={index:0,max:0,min:0};this._thresh={updating:false,element:document.createElement("div"),min:0,max:1},this._track={height:0,spectrumCan:null,node:document.createElement("div"),width:0};this._tween=false;this._attachClasses();this._track.node.appendChild(this._thresh.element);this._handle.border.appendChild(this._handle.fill);MEUtil.appendChildren(this._container,[this._track.node,this._handle.border]);this._handle.height=this._handle.border.offsetHeight;this._handle.width=this._handle.border.offsetWidth;this._handle.innerHeight=this._handle.fill.offsetHeight;this._handle.innerWidth=this._handle.fill.offsetWidth;this._bounds.height=this._container.clientHeight-this._handle.height;this._bounds.width=this._container.clientWidth-this._handle.width;this._track.width=this._thresh.element.offsetWidth;this._track.height=this._thresh.element.offsetHeight;if(this._isSpectrum){this._initSpectrum(a)}this._container.addEventListener(MEUtil.IS_TOUCH_DEVICE?"touchstart":"mousedown",this._eventListener,false);this.setPosition(a.position!=undefined?a.position:0)}MEUtil.makeSuper(OlySlider,OlyComponent);OlySlider.prototype.Orientations={HORIZONTAL:"horizontal",VERTICAL:"vertical"};OlySlider.prototype.getMinThreshold=function(){return this._thresh.max};OlySlider.prototype.getMaxThreshold=function(){return this._thresh.min};OlySlider.prototype.getPosition=function(b,a){var c=this._handle.position;if(arguments.length){if(a===undefined){return c*b}return b+c*(a-b)}return c};OlySlider.prototype.getSpectrumIndex=function(c){var b=this._spectrum.min,a=this._spectrum.max,d=c==undefined?this._handle.position:c;return Math.round(b+((a-b)*d))};OlySlider.prototype.getSpectrumRGB=function(b){var a=this.getSpectrumIndex(b),d=[];if(a<=420){d[0]=100+(Math.sin(((a-380)/40)*Math.PI)*31);d[2]=100+(((a-380)/40)*155)}else{if(a<=440){d[0]=100-(((a-420)/20)*100);d[1]=(a-440)/50;d[2]=255}else{if(a<=490){d[1]=((a-440)/50)*255;d[2]=255}else{if(a<=510){d[1]=255;d[2]=(1-((a-490)/20))*255}else{if(a<=580){d[0]=((a-510)/70)*255;d[1]=255}else{if(a<=645){d[0]=255;d[1]=(1-((a-580)/65))*255}else{if(a<=700){d[0]=255}else{d[0]=255-(((a-700)/80)*155)}}}}}}}d[0]=(d[0]+0.5)>>0;d[1]=(d[1]+0.5)>>0;d[2]=(d[2]+0.5)>>0;return d};OlySlider.prototype.getSpectrumHex=function(c){var a=this.getSpectrumRGB(c),d=[];hex="#",b;for(b=0;b<10;b++){d[b]=b}d=d.concat(["a","b","c","d","e","f"]);for(var b=0;b<a.length;b++){hex+=d[Math.floor(a[b]/16)]+""+d[(a[b]%16)]}return hex};OlySlider.prototype.setMinThreshold=function(a){var b=this._thresh;if(!isNaN(a)){if(a<0){a=0}if(a!==b.min&&a<b.max){b.min=a;this._updateThreshold()}else{console.error("Cannot set the min threshold to be less than the max.")}}else{console.error("The min must be a valid number.")}};OlySlider.prototype.setMaxThreshold=function(a){var b=this._thresh;if(!isNaN(a)){if(a>1){a=1}if(a!==b.max&&a>b.min){b.max=a;this._updateThreshold()}else{console.error("Cannot set the max threshold to be greater than the min.")}}else{console.error("The max must be a valid number.")}};OlySlider.prototype.setPosition=function(b,a){if(typeof b==="number"){b=b<0?0:b>1?1:b;if(a){this._setTween(true)}this._prepareHandleTranslation(b)}else{console.error(typeof b+"("+b+") is not a valid argument for "+this._container.id+".setPosition()")}};OlySlider.prototype.setSpectrumRange=function(b,a){this._setSpectrumRange(b,a);this._updateSpectrumTrack();this._updateSpectrumHandle()};OlySlider.prototype._pointerOffset=function(){return MEUtil.IS_TOUCH_DEVICE?-5:-this._handle[this._orient]/2};OlySlider.prototype._attachClasses=function(){var a=this._config.CSS;$(this._container).addClass(a.container);if(this._orient=="height"){$(this._container).addClass(a.vertical)}$(this._track.node).addClass(a.track.node+" webkitMaskOverflowFix");$(this._thresh.element).addClass(a.track.thresh);$(this._handle.border).addClass(a.handle.border.node);$(this._handle.fill).addClass(a.handle.fill.node+" "+a.handle.fill.up)};OlySlider.prototype._constrainPosition=function(c){var b=this._thresh;c=c<b.min?b.min:c>b.max?b.max:c;if(this.tickCount>1){var a=this.tickCount-1;c=((0.5+(c*a))|0)/a}return c};OlySlider.prototype._containerPt=function(){if(this._orient=="height"){return MEUtil.getGlobalY(this._container)-this._pointerOffset()}else{return MEUtil.getGlobalX(this._container)-this._pointerOffset()}};OlySlider.prototype._containerX=function(){return MEUtil.getGlobalX(this._container)-this._pointerOffset()};OlySlider.prototype._containerY=function(){return MEUtil.getGlobalY(this._container)-this._pointerOffset()};OlySlider.prototype._createSpectrumCanvii=function(){this._handle.spectrumCan=MEUtil.createCanvas(this._handle.innerWidth,this._handle.innerHeight);this._track.spectrumCan=MEUtil.createCanvas(this._track.width,this._track.height);this._handle.spectrumCan.className="sliderHandleFill sliderHandleSpectrumCanvas";this._track.spectrumCan.className="sliderTrackThresh";this._handle.border.appendChild(this._handle.spectrumCan);this._track.node.appendChild(this._track.spectrumCan)};OlySlider.prototype._displayLoop=function(){if(this._isActive){MEUtil.raf(this._displayLoop.bind(this))}var a=this._eventFlags;if(a.start){a.start=false;this._setHandleStyleDown()}if(a.move){a.move=false;this._moveHandle()}if(a.end){a.end=false;this._setHandleStyleUp()}if(this._isSpectrum){this._updateSpectrumHandle()}};OlySlider.prototype._getLocal=function(a){return a-this._containerPt()};OlySlider.prototype._getLocalX=function(a){return a-this._containerX()};OlySlider.prototype._getLocalY=function(a){return a-this._containerY()};OlySlider.prototype._getThreshMinPercent=function(a){return a/(this._track[this._orient]-this._handle[this._orient])};OlySlider.prototype._getThreshMaxPercent=function(b){var a=this._handle[this._orient];return(b-a)/(this._track[this._orient]-a)};OlySlider.prototype._getThreshMinX=function(a){return a*this._track[this._orient]};OlySlider.prototype._getThreshMaxX=function(a){return a*this._track[this._orient]};OlySlider.prototype._handleTouchStart=function(a){if(!this._tween){this._setTween(true)}this._isActive=true;this._eventFlags.start=true;this._setPosition(this._pxToPos(this._getLocal(a)));MEUtil.raf(this._displayLoop.bind(this));this._dispatchEvent("touchstart")};OlySlider.prototype._handleTouchMove=function(a){if(this._tween&&this.tickCount<2){this._setTween(false)}this._setPosition(this._pxToPos(this._getLocal(a)))};OlySlider.prototype._handleTouchEnd=function(){this._eventFlags.end=true;this._isActive=false;this._dispatchEvent("touchend")};OlySlider.prototype._initSpectrum=function(b){var c=400,a=700;if(b.spectrumRange){c=b.spectrumRange.min?b.spectrumRange.min:c;a=b.spectrumRange.max?b.spectrumRange.max:a}this._createSpectrumCanvii();this._setSpectrumRange(c,a);this._updateSpectrumTrack();this._updateSpectrumHandle()};OlySlider.prototype._moveHandle=function(){if(this._orient=="height"){this._handle.border.style[MEUtil.getPrefixedProp("Transform")]="translateY("+this._handle.y+"px)"}else{this._handle.border.style[MEUtil.getPrefixedProp("Transform")]="translateX("+this._handle.x+"px)"}};OlySlider.prototype._posToPx=function(a){return(0.5+a*this._bounds[this._orient])|0};OlySlider.prototype._pxToPos=function(a){return a/this._bounds[this._orient]};OlySlider.prototype._prepareHandleTranslation=function(a){this._handle.position=a;if(this._orient=="height"){this._handle.y=this._posToPx(a)}else{this._handle.x=this._posToPx(a)}this._eventFlags.move=true;this.hasChanged=true;if(!this._isActive){MEUtil.raf(this._displayLoop.bind(this))}this._dispatchEvent("change")};OlySlider.prototype._setHandleStyleDown=function(){var a=this._config.CSS.handle;$(this._handle.border).addClass(a.border.down);$(this._handle.fill).addClass(a.fill.down)};OlySlider.prototype._setHandleStyleUp=function(){var a=this._config.CSS.handle;$(this._handle.border).removeClass(a.border.down);$(this._handle.fill).removeClass(a.fill.down)};OlySlider.prototype._setPosition=function(b,a){b=this._constrainPosition(b);if(b!=this._handle.position){this.setPosition(b)}};OlySlider.prototype._setSpectrumRange=function(b,a){this._spectrum.min=b;this._spectrum.max=a};OlySlider.prototype._setTween=function(a){if(this._tween!==a){$(this._handle.border)[a?"addClass":"removeClass"]("sliderHandleTween");this._tween=a}};OlySlider.prototype._mouseHandler=function(b){b.stopPropagation();b.preventDefault();var c=this._orient=="height"?"clientY":"clientX";switch(b.type){case"mousemove":this._handleTouchMove(b[c]);break;case"mousedown":if(b.which===1&&this._isEnabled){this._container.removeEventListener("mousedown",this._eventListener);MEUtil.on(document,"mousemove mouseup mouseout",this._eventListener);this._handleTouchStart(b[c])}break;case"mouseout":var a=document.defaultView.getComputedStyle(document.querySelector("body"),"").getPropertyValue("outline-style");if(a==="dashed"){break}case"mouseup":MEUtil.off(document,"mousemove mouseup mouseout",this._eventListener);this._container.addEventListener("mousedown",this._eventListener);this._handleTouchEnd()}};OlySlider.prototype._touchHandler=function(c){var e=this._orient=="height"?"pageY":"pageX";switch(c.type){case"touchmove":var d=c.changedTouches;for(var b=0,a=d.length;b<a;b++){if(this._touch.identifier===d[b].identifier){this._handleTouchMove(d[b][e]);break}}break;case"touchstart":if(this._isEnabled){this._container.removeEventListener("touchstart",this._eventListener);MEUtil.on(document,"touchmove touchend touchcancel",this._eventListener);var f=c.changedTouches[0];this._touch=f;this._handleTouchStart(f[e])}break;case"touchcancel":case"touchend":var d=c.changedTouches;for(var b=0,a=d.length;b<a;b++){if(this._touch.identifier===d[b].identifier){MEUtil.off(document,"touchmove touchend touchcancel",this._eventListener);this._container.addEventListener("touchstart",this._eventListener);this._handleTouchEnd();break}}}};OlySlider.prototype._updateSpectrumHandle=function(){var a=this._handle.spectrumCan.getContext("2d"),b=this.getSpectrumRGB(this._handle.position);a.fillStyle="black";a.fillRect(0,0,this._handle.innerWidth,this._handle.innerHeight);a.fillStyle="rgb("+b.join(",")+")";a.fillRect(1,1,this._handle.innerWidth-2,this._handle.innerHeight-2)};OlySlider.prototype._updateSpectrumTrack=function(){var b=this._track.spectrumCan.getContext("2d"),d=[],a=this._track.width,e=this._track.height;b.clearRect(0,0,a,e);if(this._orient=="height"){for(var c=0;c<e;c++){d=this.getSpectrumRGB(c/e);b.fillStyle="rgb("+d.join(",")+")";b.fillRect(0,c,a,1)}}else{for(var c=0;c<a;c++){d=this.getSpectrumRGB(c/a);b.fillStyle="rgb("+d.join(",")+")";b.fillRect(c,0,1,e)}}};OlySlider.prototype._updateThreshold=function(){if(!this._thresh.updating){this._thresh.updating=true;var a=function(){var b=this._thresh;if(this._orient=="height"){b.element.style.clip="rect("+Math.round(this._getThreshMaxX(b.max))+"px 0 "+Math.round(this._getThreshMinX(b.min))+"px "+b.element.clientWidth+"px)"}else{b.element.style.clip="rect(0 "+Math.round(this._getThreshMaxX(b.max))+"px "+b.element.clientHeight+"px "+Math.round(this._getThreshMinX(b.min))+"px)"}b.updating=false;this._setPosition(this.getPosition())};MEUtil.raf(a.bind(this))}};function OlyButton(f,e){if(!(this instanceof arguments.callee)){return new arguments.callee(f,e)}OlyComponent.call(this,f);this.text=document.createElement("div");this.toggleText=null;this.ontouch=null;this.ontouchstart=null;this._face=document.createElement("div");this._isEnabled=true;this._isToggle=e;this._isToggledOn=false;this._config={CSS:{bg:"button",face:"buttonFace",down:"buttonFaceDown",text:"buttonText",crater:"buttonCrater",light:"buttonLight"}};this._eventListener=MEUtil.IS_TOUCH_DEVICE?this._touchHandler.bind(this):this._mouseHandler.bind(this);var b=this._config.CSS;$(this._container).addClass(b.bg);$(this._face).addClass(b.face);this.text.className=b.text;this.text.innerHTML=this._container.innerHTML;this._container.innerHTML="";if(e){var d=document.createElement("div"),a=this._container.clientWidth,c=this._container.clientHeight;this.text.style.left="19px";this.text.style.width=(a-19)+"px";d.className=b.crater;d.style.left="5px";d.style.top=((c-14)/2)+"px";this._light=document.createElement("div");this._light.className=b.light;d.appendChild(this._light);this._face.appendChild(d)}this._face.appendChild(this.text);this._container.appendChild(this._face);this._container.addEventListener(MEUtil.IS_TOUCH_DEVICE?"touchstart":"mousedown",this._eventListener)}MEUtil.makeSuper(OlyButton,OlyComponent);OlyButton.prototype.getToggleState=function(){return this._isToggledOn};OlyButton.prototype.setToggleState=function(b,a){this._setToggle(b);if(a&&this.ontouch){MEUtil.raf(this.ontouch.bind(this))}};OlyButton.prototype._mouseHandler=function(b){b.stopPropagation();b.preventDefault();var a=this._container;switch(b.type){case"mousedown":if(b.which===1&&this._isEnabled){a.removeEventListener("mousedown",this._eventListener);MEUtil.on(a,"mouseup mouseout",this._eventListener);this._setStateDown()}break;case"mouseout":case"mouseup":MEUtil.off(a,"mouseup mouseout",this._eventListener);a.addEventListener("mousedown",this._eventListener);this._setStateUp()}};OlyButton.prototype._touchHandler=function(d){var b=this._container;switch(d.type){case"touchstart":if(this._isEnabled){this._touch=d.changedTouches[0];b.removeEventListener("touchstart",this._eventListener);MEUtil.on(b,"touchend touchcancel",this._eventListener);this._setStateDown()}break;case"touchcancel":case"touchend":var e=d.changedTouches;for(var c=0,a=e.length;c<a;c++){if(this._touch.identifier===e[c].identifier){MEUtil.off(b,"touchend touchcancel",this._eventListener);b.addEventListener("touchstart",this._eventListener);this._setStateUp();break}}}};OlyButton.prototype._setToggle=function(a){this._isToggledOn=a;this._light.style.opacity=a?1:0;if(this.toggleText){if(this.toggleText.length>1){this.text.innerHTML=this.toggleText[+a]}else{this.text.innerHTML=this.toggleText[0]}}};OlyButton.prototype._setStateUp=function(){$(this._face).removeClass(this._config.CSS.down);if(this._isToggle){this._setToggle(!this._isToggledOn)}this._dispatchEvent("touch")};OlyButton.prototype._setStateDown=function(){$(this._face).addClass(this._config.CSS.down);this._dispatchEvent("touchstart")};function OlyRadioGroup(b,a){if(!(this instanceof arguments.callee)){return new arguments.callee(b,a)}OlyComponent.call(this,b);a=a||{};this.onchange=null;this.ontouchstart=null;this._config={CSS:{group:"radioGroup",button:"radioButton",horizontal:"horizontalRadioGroup",vertical:"verticalRadioGroup",selected:"radioButtonSelected"}};this._borderRadius=a.borderRadius||"3px";this._btns=this._createButtonArray(this._container.children);this._eventListener=MEUtil.IS_TOUCH_DEVICE?this._touchHandler.bind(this):this._mouseHandler.bind(this);this._gutterSize="1px";this._orientation=a.orientation&&a.orientation.toLowerCase()||"horizontal";this._selectedBtn=null;this._touches=null;this._container.classList.add("webkitMaskOverflowFix");this._addClass(this._container,"group");this._updateButtons();this._attachHandlers()}MEUtil.makeSuper(OlyRadioGroup,OlyComponent);OlyRadioGroup.prototype.getButtonAtIndex=function(a){return this._btns[a]||null};OlyRadioGroup.prototype.getLength=function(){return this._btns.length};OlyRadioGroup.prototype.getSelectedButton=function(){return this._selectedBtn||null};OlyRadioGroup.prototype.getSelectedIndex=function(){return this._selectedBtn?this._selectedBtn.olyRadioIndex:null};OlyRadioGroup.prototype.setBorderRadius=function(b,c){if(!isNaN(b)){c=isNaN(c)?b+2:c;var a=this._config.CSS;MEUtil.setRuleProperty("."+a.horizontal+":first-child","border-radius",b+"px 0 0 "+b+"px");MEUtil.setRuleProperty("."+a.horizontal+":last-child","border-radius","0 "+b+"px "+b+"px 0");MEUtil.setRuleProperty("."+a.vertical+":first-child","border-radius",b+"px "+b+"px 0 0");MEUtil.setRuleProperty("."+a.vertical+":last-child","border-radius","0 0 "+b+"px "+b+"px");MEUtil.setRuleProperty("."+a.group,"border-radius",c+"px")}};OlyRadioGroup.prototype.setButtonStyleProperty=function(f,e){var d=this._btns,a=d.length,c=null;if(typeof f==="string"&&typeof e==="object"&&e.length&&e.length===a){for(var b=0;b<a;b++){d[b].style.setProperty(f,e[b],null)}}else{console.error("Style property: "+f+" was unable to be added with the values: "+e)}};OlyRadioGroup.prototype.setButtonTitle=function(a,c){var b=this._btns;if(typeof a==="number"&&c!==undefined){if(a>=0&&a<b.length){b[parseInt(a,10)].children[0].innerHTML=c}}else{console.error(a+" and "+c+" are not valid arguments.  Pass a number and string.")}};OlyRadioGroup.prototype.setCSSConfiguration=function(a){var b=this._config.CSS;for(var c in a){if(b[c]){b[c]=a[c]}else{console.error(c+" is not a configuration property.")}}this._updateButtons()};OlyRadioGroup.prototype.setCustomProperty=function(e,d){var c=this._btns,a=c.length;if(typeof e==="string"&&typeof d==="object"&&d.length&&d.length===a){for(var b=0;b<a;b++){c[b][e]=d[b]}}else{console.error("Custom property: "+e+" was unable to be added with the values: "+d)}};OlyRadioGroup.prototype.setGutterSize=function(a){a=typeof a==="number"?a+"px":a;MEUtil.setRuleProperty("."+this._config.CSS.vertical+":nth-child(n+2)","margin",a+" 0 0 0");MEUtil.setRuleProperty("."+this._config.CSS.horizontal+":nth-child(n+2)","margin","0 0 0 "+a)};OlyRadioGroup.prototype.setOrientation=function(a){a=a.toLowerCase()||this._orientation;if(a==="horizontal"||a==="vertical"){if(this._orientation!==a){this._orientation=a;this._updateButtons()}}};OlyRadioGroup.prototype.setSelectedIndex=function(a,d){if(isNaN(a)){this._unselect(this._selectedBtn);this._selectedBtn=null}else{if(!this._selectedBtn||a!==this._selectedBtn.olyRadioIndex){var c=this._btns,b=c[a<-1?0:a>=c.length?c.length-1:parseInt(a,10)];d=d===undefined?true:d;this._handleBtnPressed(b);this._handleBtnReleased(b,d)}}};OlyRadioGroup.prototype.setTitles=function(d){if(d&&d.length){var c=this._btns;for(var b=0,a=c.length;b<a;b++){c[b].children[0].innerHTML=d[b]||c[b].children[0].innerHTML}}else{console.error("setTitles: "+d+" - value passed was not a valid array.")}};OlyRadioGroup.prototype._addClass=function(a,b){a.classList.add(this._config.CSS[b])};OlyRadioGroup.prototype._addTouchListener=function(b){var a=MEUtil.IS_TOUCH_DEVICE?"touchstart":"mousedown";b.addEventListener(a,this._eventListener)};OlyRadioGroup.prototype._addTouchEndListener=function(b){var c=MEUtil.IS_TOUCH_DEVICE?"touchend touchcancel":"mouseup mouseout",a=MEUtil.IS_TOUCH_DEVICE?"touchstart":"mousedown";b.removeEventListener(a,this._eventListener);MEUtil.on(b,c,this._eventListener)};OlyRadioGroup.prototype._attachHandlers=function(){var d=this._btns,c=null;for(var b=0,a=d.length;b<a;b++){c=d[b];this._addTouchListener(c)}};OlyRadioGroup.prototype._createButtonArray=function(e){var d=[];for(var c=0,a=e.length;c<a;c++){var b=document.createElement("div");b.appendChild(e[c].cloneNode(true));if(e[c].className){b.userClassName=e[c].className}d[c]=b}return d};OlyRadioGroup.prototype._handleBtnPressed=function(a,b){this._addClass(a,"selected");this._addTouchEndListener(a);if(b){this._dispatchEvent("touchstart")}};OlyRadioGroup.prototype._handleBtnReleased=function(b,c){var a=this._selectedBtn;if(b){this._removeTouchEndListener(b);if(this._touches&&this._touches.length){this._unselect(b)}else{if(a){this._unselect(a)}this._selectedBtn=b;if(c){this._dispatchEvent("change")}}}};OlyRadioGroup.prototype._mouseHandler=function(b){b.preventDefault();var a=b.currentTarget;switch(b.type){case"mousedown":if(b.which===1&&this._isEnabled){this._handleBtnPressed(a,true)}break;case"mouseout":case"mouseup":this._handleBtnReleased(a,true)}};OlyRadioGroup.prototype._removeClass=function(a,b){a.classList.remove(this._config.CSS[b])};OlyRadioGroup.prototype._removeTouchEndListener=function(a){var b=MEUtil.IS_TOUCH_DEVICE?"touchend touchcancel":"mouseup mouseout";MEUtil.off(a,b,this._eventListener)};OlyRadioGroup.prototype._touchHandler=function(b){var a=b.currentTarget;this._touches=b.touches;switch(b.type){case"touchstart":if(this._isEnabled){this._handleBtnPressed(a,true)}break;case"touchcancel":case"touchend":this._handleBtnReleased(a,true)}};OlyRadioGroup.prototype._unselect=function(a){if(a){this._removeClass(a,"selected");this._addTouchListener(a)}};OlyRadioGroup.prototype._updateButtons=function(){var d=this._btns,c=null;this._container.innerHTML="";for(var b=0,a=d.length;b<a;b++){c=d[b];c.olyRadioIndex=b;c.style.className=c.userClassName||"";this._addClass(c,"button");this._addClass(c,this._orientation)}MEUtil.appendChildren(this._container,d)};function TouchBox(b,a){if(!(this instanceof arguments.callee)){return new arguments.callee(b,a)}OlyComponent.call(this,b);a=a||{};this.height=this._container.clientHeight;this.width=this._container.clientWidth;this.hasChanged=false;this.onchange=null;this.ontouchstart=null;this.ontouchend=null;this._bounds={left:0,width:0};this._eventFlags={start:false,move:false,end:false};this._isActive=false;this._eventListener=MEUtil.IS_TOUCH_DEVICE?this._touchHandler.bind(this):this._mouseHandler.bind(this);this._point={x:0,y:0};this._lastPoint=this.point;this._touch=null;this._container.addEventListener(MEUtil.IS_TOUCH_DEVICE?"touchstart":"mousedown",this._eventListener,false)}MEUtil.makeSuper(TouchBox,OlyComponent);TouchBox.prototype.getPoint=function(){return this._point};TouchBox.prototype.setPoint=function(a,b){this._setPoint({x:a,y:b});this._dispatchEvent("change")};TouchBox.prototype._containerX=function(){return this._getGlobalPoint().x-this._pointerOffset};TouchBox.prototype._getGlobalX=function(){var b=this._container;var a=0;do{a+=b.offsetLeft}while(b=b.offsetParent);return a};TouchBox.prototype._getGlobalPoint=function(){var a=$(this._container).offset();return{x:a.left,y:a.top}};TouchBox.prototype._containerPoint=function(){var a=this._getGlobalPoint();return{x:a.x-this._pointerOffsetX,y:a.y-this._pointerOffsetY}};TouchBox.prototype._pointerOffsetX=MEUtil.IS_TOUCH_DEVICE?0:0;TouchBox.prototype._pointerOffsetY=MEUtil.IS_TOUCH_DEVICE?0:0;TouchBox.prototype._getLocalPoint=function(b,a){var c=this._containerPoint();return{x:b-c.x,y:a-c.y}};TouchBox.prototype._setPoint=function(a){if(a.x<0){this._point.x=0}else{if(a.x>this.width){this._point.x=this.width}else{this._point.x=a.x}}if(a.y<0){this._point.y=0}else{if(a.y>this.height){this._point.y=this.height}else{this._point.y=a.y}}};TouchBox.prototype._setStateUp=function(){if(this._isToggle){this._setToggle(!this._isToggledOn)}this._dispatchEvent("touch")};TouchBox.prototype._setStateDown=function(){$(this._face).addClass(this._config.CSS.down);this._dispatchEvent("touchstart")};TouchBox.prototype._handleTouchStart=function(b,a){this._isActive=true;this._eventFlags.start=true;this._setPoint(this._getLocalPoint(b,a));this._dispatchEvent("touchstart");this._dispatchEvent("change")};TouchBox.prototype._handleTouchMove=function(b,a){this._setPoint(this._getLocalPoint(b,a));this._dispatchEvent("change")};TouchBox.prototype._handleTouchEnd=function(){this._eventFlags.end=true;this._isActive=false;this._dispatchEvent("touchend")};TouchBox.prototype._mouseHandler=function(b){b.stopPropagation();b.preventDefault();switch(b.type){case"mousemove":this._handleTouchMove(b.clientX,b.clientY);break;case"mousedown":if(b.which===1&&this._isEnabled){this._container.removeEventListener("mousedown",this._eventListener);MEUtil.on(document,"mousemove mouseup mouseout",this._eventListener);this._handleTouchStart(b.clientX,b.clientY)}break;case"mouseout":var a=document.defaultView.getComputedStyle(document.querySelector("body"),"").getPropertyValue("outline-style");if(a==="dashed"){break}case"mouseup":MEUtil.off(document,"mousemove mouseup mouseout",this._eventListener);this._container.addEventListener("mousedown",this._eventListener);this._handleTouchEnd()}this._hasChanged=true};TouchBox.prototype._touchHandler=function(c){switch(c.type){case"touchmove":var d=c.changedTouches;for(var b=0,a=d.length;b<a;b++){if(this._touch.identifier===d[b].identifier){this._handleTouchMove(d[b].pageX,d[b].pageY);break}}break;case"touchstart":if(this._isEnabled){this._container.removeEventListener("touchstart",this._eventListener);MEUtil.on(document,"touchmove touchend touchcancel",this._eventListener);var e=c.changedTouches[0];this._touch=e;this._handleTouchStart(e.pageX,e.pageY)}break;case"touchcancel":case"touchend":var d=c.changedTouches;for(var b=0,a=d.length;b<a;b++){if(this._touch.identifier===d[b].identifier){MEUtil.off(document,"touchmove touchend touchcancel",this._eventListener);this._container.addEventListener("touchstart",this._eventListener);this._handleTouchEnd();break}}}this._hasChanged=true};
